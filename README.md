# OTP Service

Проект представляет собой backend-сервис на Java (Spring Boot) для генерации, отправки и валидации одноразовых кодов подтверждения (OTP).  
Он может использоваться как самостоятельное приложение, так и быть частью микросервисной архитектуры, взаимодействуя с другими системами, например, с банковским сервисом на Go.

## Технологии

- Java 17
- Spring Boot 3.4
- Spring Web
- Spring Data JDBC
- Spring Security
- PostgreSQL
- Maven
- BCrypt (хеширование паролей)
- JavaMail (для будущей рассылки по Email)

## Что уже реализовано

- Инициализирован Maven-проект
- Настроена структура пакетов
- Создана сущность `User` с ролями `USER` и `ADMIN`
- Реализована таблица `users` в базе данных через `schema.sql`
- Подключена PostgreSQL и настроен `application.properties`
- Создан DAO-слой `UserRepository` с поддержкой:
    - поиска по username, email, роли
    - добавления пользователя
    - проверки существования администратора
- Реализован `UserService` с возможностью:
    - регистрации пользователя
    - проверок уникальности имени и почты
    - ограничения на единственного администратора
    - хеширования пароля с помощью BCrypt
- Реализован REST-эндпоинт POST /register:
  - Создание пользователя с ролями USER/ADMIN
  - Проверка уникальности username/email
  - Ограничение: может быть только один администратор
  - Валидация входящих данных через @Valid и DTO
  - Возврат структурированных JSON-ответов с кодами 201, 400, 409

## Структура проекта
src/
├── main/
│   ├── java/com/example/otpservice/
│   │   ├── controller/                      # REST-контроллеры (AuthController)
│   │   ├── dto/                             # DTO с аннотациями валидации (RegistrationRequest)
│   │   ├── exception/                       # Глобальные обработчики ошибок (GlobalExceptionHandler)
│   │   ├── model/                           # Модели данных (User)
│   │   ├── dao/                             # Репозитории (UserRepository)
│   │   ├── service/                         # Бизнес-логика (UserService)
│   │   └── config/                          # Конфигурация Spring Security (SecurityConfig)
│   └── resources/
│       ├── application.properties
│       └── schema.sql


## Настройка окружения

1. Создайте свой файл конфигурации:
```bash
cp src/main/resources/application.example.properties src/main/resources/application.properties
```


## План работ

1. Создание REST-контроллера `/register` и DTO с валидацией
2. Реализация логина и генерации JWT
3. Настройка фильтрации запросов по ролям и авторизации
4. Создание конфигурации OTP-кода и таблицы `otp_config`
5. Генерация OTP-кодов (бизнес-логика и модель)
6. Реализация рассылки кода: Email, SMS (эмулятор SMPP), Telegram, файл
7. Проверка и валидация OTP-кодов
8. Планировщик истечения срока действия OTP-кодов
9. Логирование событий в приложении
10. Тесты и документация по API

## Примечания

- Конфигурационный файл `application.properties` исключён из репозитория. Используйте `application.example.properties` как шаблон.
